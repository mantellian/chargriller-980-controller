esphome:
  name: chargriller-980

esp32:
  board: esp32dev
  framework:
    type: arduino

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password
  power_save_mode: none
  ap:
    ssid: "CharGriller-980"
    password: "chargriller980"

captive_portal:

logger:
  level: DEBUG

api:
  encryption:
    key: !secret api_encryption_key

ota:
  platform: esphome
  password: !secret ota_password

web_server:
  port: 80

# -------------------------------------------------------
# SPI â€“ MAX31855 Thermocouple Amplifier
# -------------------------------------------------------
spi:
  clk_pin: GPIO18
  miso_pin: GPIO19

sensor:
  # MAX31855 thermocouple
  - platform: max31855
    name: "Pit Temperature"
    cs_pin: GPIO21
    update_interval: 1s
    id: pit_temp

  # Fan Tachometer
  - platform: pulse_counter
    pin: GPIO17
    name: "Fan RPM"
    unit_of_measurement: "RPM"
    update_interval: 1s
    id: fan_rpm

  # Rotary Encoder
  - platform: rotary_encoder
    name: "Temp Setpoint"
    id: temp_setpoint
    pin_a: GPIO32
    pin_b: GPIO33
    min_value: 0
    max_value: 450
    resolution: 1

# -------------------------------------------------------
# TM1637 Displays
# -------------------------------------------------------
display:
  - platform: tm1637
    id: tm1637_current
    clk_pin: GPIO23
    dio_pin: GPIO26
    update_interval: 0.5s

  - platform: tm1637
    id: tm1637_setpoint
    clk_pin: GPIO5
    dio_pin: GPIO22
    update_interval: 0.5s

# -------------------------------------------------------
# Door Switch & Encoder Button
# -------------------------------------------------------
binary_sensor:
  # Door switch
  - platform: gpio
    pin:
      number: GPIO13
      mode: INPUT_PULLUP
    id: lid_switch
    name: "Lid Switch"
    device_class: opening
    filters:
      - invert: {}

  # Encoder push button
  - platform: gpio
    pin:
      number: GPIO27
      mode: INPUT_PULLUP
    id: encoder_button
    name: "Encoder Button"
    filters:
      - invert: {}

# -------------------------------------------------------
# Fan PWM Output
# -------------------------------------------------------
output:
  - platform: ledc
    pin: GPIO16
    frequency: 25000 Hz
    id: fan_pwm

fan:
  - platform: speed
    output: fan_pwm
    name: "Blower Fan"
    id: blower

# -------------------------------------------------------
# Buzzer
# -------------------------------------------------------
switch:
  - platform: gpio
    pin: GPIO4
    id: buzzer
    name: "Buzzer"
